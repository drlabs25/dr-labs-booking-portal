<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <?!= include('style'); ?>
  <script><?!= include('script'); ?></script>
</head>
<body>

<header>
    Agent Dashboard - <span id="agentName"></span> | <span id="dateTime"></span>
    <nav>
        <button onclick="window.history.back()">Back</button>
        <button onclick="window.location.href='https://script.google.com/macros/s/AKfycbyLXVqjq8B5qpoqNOIxaUK6W0JQeaUTHQJMhYlJEBrDDGRgSOn5_EAzlMNFtq1nxTlx9Q/exec'">Home</button>
    </nav>
</header>

<div class="container">
    <h3>Booking Search</h3>
    <div class="inline">
        <input type="number" id="custNumber" maxlength="10" placeholder="Enter Customer Number">
        <button onclick="searchBookingHistory()">Search</button>
        <button onclick="document.getElementById('bookingForm').style.display='block'">Create Booking</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Customer Number</th>
                <th>Customer Name</th>
                <th>Preferred Date & Time</th>
                <th>Technician Name</th>
                <th>Agent Name</th>
                <th>Edit</th>
                <th>Cancel</th>
                <th>Paid</th>
            </tr>
        </thead>
        <tbody id="bookingHistoryBody"></tbody>
    </table>
</div>

<div class="container" id="bookingForm" style="display:none;">
    <h3>Create Booking</h3>
    <form id="bookingFormData">
        <div class="form-grid">
            <div>
                <label>Customer Number</label>
                <input type="number" name="customerNumber" required maxlength="10">
            </div>
            <div>
                <label>Main Customer Name</label>
                <input type="text" name="mainCustomerName" pattern="[A-Za-z ]+" required>
            </div>
            <div>
                <label>Date of Birth</label>
                <input type="date" name="dob" id="dob" onchange="calculateAge()">
            </div>
            <div>
                <label>Age</label>
                <input type="number" name="age" id="age" required>
            </div>
            <div>
                <label>Gender</label>
                <select name="gender" required>
                    <option>Male</option>
                    <option>Female</option>
                </select>
            </div>
            <div>
                <label>Address</label>
                <textarea name="address" maxlength="500" required></textarea>
            </div>
            <div>
                <label>Location</label>
                <input type="text" name="location" maxlength="100" required>
            </div>
            <div>
                <label>City</label>
                <select name="city" required>
                    <option>Chennai</option>
                    <option>Bangalore</option>
                    <option>Hyderabad</option>
                    <option>Mumbai</option>
                    <option>Delhi</option>
                    <option>Coimbatore</option>
                </select>
            </div>
            <div>
                <label>Phlebo</label>
                <select name="phleboName" required>
                    <option>Phlebo 1</option>
                    <option>Phlebo 2</option>
                </select>
            </div>
            <div>
                <label>Pincode</label>
                <input type="number" name="pincode" maxlength="6" required>
            </div>
            <div>
                <label>Preferred Date</label>
                <input type="date" name="preferredDate" id="prefDate" required>
            </div>
            <div>
                <label>Preferred Time</label>
                <select name="preferredTime" required>
                    <option>6:00am - 6:30am</option>
                    <option>6:30am - 7:00am</option>
                    <option>7:00am - 7:30am</option>
                    <option>7:30am - 8:00am</option>
                    <option>8:00am - 8:30am</option>
                    <option>8:30am - 9:00am</option>
                    <option>9:00am - 9:30am</option>
                    <option>9:30am - 10:00am</option>
                    <option>10:00am - 10:30am</option>
                    <option>10:30am - 11:00am</option>
                    <option>11:00am - 11:30am</option>
                    <option>11:30am - 12:00pm</option>
                    <option>12:00pm - 12:30pm</option>
                    <option>12:30pm - 1:00pm</option>
                    <option>1:00pm - 1:30pm</option>
                    <option>1:30pm - 2:00pm</option>
                    <option>2:00pm - 2:30pm</option>
                    <option>2:30pm - 3:00pm</option>
                    <option>3:00pm - 3:30pm</option>
                    <option>3:30pm - 4:00pm</option>
                    <option>4:00pm - 4:30pm</option>
                    <option>4:30pm - 5:00pm</option>
                    <option>5:00pm - 5:30pm</option>
                    <option>5:30pm - 6:00pm</option>
                </select>
            </div>
            <div>
                <label>Test</label>
                <input type="text" name="tests" placeholder="Search and select tests">
            </div>
            <div>
                <label>Package</label>
                <input type="text" name="packages" placeholder="Search and select packages">
            </div>
            <div>
                <label>Total Amount</label>
                <input type="number" name="totalAmount" id="totalAmount" readonly>
            </div>
            <div>
                <label>Discount</label>
                <select name="discount" id="discount" required>
                    <option value="0">None</option>
                    <option value="10">10%</option>
                </select>
            </div>
            <div>
                <label>Technician Charge</label>
                <input type="number" name="techCharge" id="techCharge" required>
            </div>
            <div>
                <label>Total Amount to be Paid</label>
                <input type="number" name="totalToPay" id="totalToPay" readonly>
            </div>
        </div>

        <div style="margin-top:15px;">
            <button type="button" onclick="submitBooking()">Submit</button>
            <button type="button">Sub Booking</button>
            <button type="button">Confirm Booking</button>
        </div>
    </form>
</div>

<script>
document.getElementById('agentName').innerText = sessionStorage.getItem('agentName') || '';
document.getElementById('dateTime').innerText = new Date().toLocaleString();

let today = new Date().toISOString().split("T")[0];
document.getElementById('prefDate').setAttribute('min', today);

function calculateAge() {
    let dob = document.getElementById('dob').value;
    if (dob) {
        let birthDate = new Date(dob);
        let age = new Date().getFullYear() - birthDate.getFullYear();
        let m = new Date().getMonth() - birthDate.getMonth();
        if (m < 0 || (m === 0 && new Date().getDate() < birthDate.getDate())) {
            age--;
        }
        document.getElementById('age').value = age;
    }
}
</script>

</body>
</html>
